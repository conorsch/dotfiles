#!/bin/bash
# Wrapper script to halt and delete a Qubes VM.
set -euo pipefail


if [[ $# -lt 1 ]] ; then
	>&2 echo "Usage: $0 <vm_name> [vm_name...]"
	exit 1
fi


for vm_name in "$@" ; do
	if ! qvm-check --quiet "$vm_name" ; then
		>&2 echo "Error: VM '$vm_name' does not exist"
		exit 1
	fi
done

>&2 echo "Shutting down VMs..."
# Force option is necessary for e.g. sys-net
qvm-shutdown --wait --force "$@"
>&2 echo "Deleting VMs..."
qvm-remove -f "$@"
