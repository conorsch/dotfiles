# vim: ft=bash
# Intentionally quite sparse: load the profile for logins,
# then load the default bashrc. That's it.
[[ -f ~/.profile ]] && source ~/.profile
[[ -f ~/.bashrc ]] && source ~/.bashrc

# Autostart zellij. Template generated via:
#
#   zellij setup --generate-auto-start bash
#
# Customized such that:
#
#   * automatic re-attach happens on servers
#   * but on graphical workstations, fresh sessions are created.
#
# That seems like a decent balance. We specify the zellij session
# logic in ~/.bash_profile so that it only affects login shells.
if hash zellij > /dev/null 2>&1 ; then
  most_recent_zellij_session="$(zellij ls --short --reverse | head -n 1)"
  # Proceed only if we're not already in a zellij session.
  if [[ -z "$ZELLIJ" ]] && [[ "${SHLVL:-1}" -ne 1 ]]; then
    # If we're running a GUI terminal application, i.e. we're on a graphial workstation,
    # don't autoattach, just start a fresh session.
    if [[ -n "$TERMINAL" ]] && [[ -n "$most_recent_zellij_session" ]] ; then
      zellij
    # Otherwise, attach to whatever's there.
    else
      zellij attach --force-run-commands "$most_recent_zellij_session"
    fi
    # What's the purpose of AUTO_EXIT? This was generated by the zellij cmd.
    if [[ "$ZELLIJ_AUTO_EXIT" == "true" ]]; then
      exit
    fi
  fi
fi
