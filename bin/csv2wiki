#!/usr/bin/perl
# quick script to convert a CSV file to Wiki table markup;
use strict;
use warnings;
use diagnostics;      # useful for debugging;
use feature 'say';    # beats print;
use Getopt::Long;     # for parsing command-line options;

my $usage = <<'END';
csv2wiki

convert a CSV file to Wiki table markup. This script reads from STDIN, 
and writes to STDOUT, so getcher pipes ready. Spit a file at it and 
direct the result wherever you want.

Usage: 
    cat FILE | csv2wiki 
    cat FILE | csv2wiki > NEWFILE
    csv2wiki --help                     # show this usage information

Supported options:

    -h, --help                          # show this usage information

END

GetOptions(
    'd|delimiter=s'  => \my $delimiter,
    'help|h|usage|?' => \my $help,
    'verbose|v'      => \my $verbose,
) or die "$usage";

$delimiter = ',' unless $delimiter;    # set comma as default field separator;

say '{| border="1" cellspacing="0" cellpadding="5" align="center"';    # open table formatting;
my ( @headers, @rows );                                                # initialize arrays for storing headers differently from data;
while ( <STDIN> ) {                                                    # read from STDIN for CSV data;
    chomp $_;                                                          # remove pesky trailing newline;

    if ( $. == 1 ) {                                                   # treat first line of file differently (assume headers/column names);
        say '!' . $_ for ( split( /$delimiter/, $_, -1 ) );                # write headers to STDOUT ( '!' in wiki markup means bold those headers);
        say '|-';                                                      # end this line of the wiki table;
        next;                                                          # skip to next line;
    }

    say '|' . $_ for ( split( /$delimiter/, $_, -1 ) );                    # split file on commas;
    say '|-';                                                          # end this line of the wiki table;
}

say '|}';                                                              # close table formatting;
