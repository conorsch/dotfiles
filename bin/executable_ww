#!/usr/bin/env bash
# ww: Productivity tool to capture notes, quickly.
# Immediately grabs focus and writes persistently
# to disk, in ~/.local/share/ww
#
# Named after "written when?"
set -euo pipefail


data_directory="${HOME:?}/.local/share/ww"
mkdir -p "$data_directory"

# generate unique filename
random_name="$(diceware -n2 --no-caps -d'-')"
output_filename="${data_directory}/${random_name}.md"

# ensure that probably-unique filename isn't taken
if [[ -e "$output_filename" ]] ; then
  gum log --level=error "filename already exists: $output_filename"
  exit 1
fi

# support invocations via cli or rofi: if stdin is a terminal,
# start a terminal editor. otherwise, use a graphical editor.
if [[ -t 0 ]] ; then
    _editor="${EDITOR:-vim}"
else
    _editor="${EDITOR:-kate}"
fi

"$_editor" "$output_filename"
gum log --level=debug "wrote output to $output_filename"
