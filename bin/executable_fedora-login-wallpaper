#!/bin/bash
# Customize the vanilla Gnome login screen for Fedora Workstation
# with a different pic.
# via https://www.debugpoint.com/change-login-background-fedora/
set -euo pipefail

# Sanity check: are we running Fedora?
if ! grep -q '^NAME="Fedora' /etc/os-release ; then
    >&2 echo "ERROR: not a Fedora installation, exiting"
    exit 1
fi

if ! hash set-gdm-wallpaper > /dev/null 2>&1 ; then
    echo "Installing 'set-gdm-wallpaper'..."
    sudo dnf copr enable zirix/gdm-wallpaper
    sudo dnf install -y gdm-wallpaper
fi

if [[ ! -e ~/src/desktoppics ]]; then
    echo "Cloning desktoppics..."
    git clone https://github.com/conorsch/desktoppics ~/src/desktoppics
fi

echo "Setting random picture..."
random_pic="$(fd -t f . ~/src/desktoppics | sort -R | head -n 1)"
sudo set-gdm-wallpaper "$random_pic"
